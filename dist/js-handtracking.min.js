!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.HT=f()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var CV=CV||{};CV.Image=function(width,height,data){this.width=width||0,this.height=height||0,this.data=data||[]},CV.findContours=function(imageSrc){var deltas,pix,outer,hole,i,j,contours=[],src=imageSrc.data,width=imageSrc.width-2,height=imageSrc.height-2,pos=width+3,nbd=1;for(deltas=CV.neighborhoodDeltas(width+2),i=0;height>i;++i,pos+=2)for(j=0;width>j;++j,++pos)pix=src[pos],0!==pix&&(outer=hole=!1,1===pix&&0===src[pos-1]?outer=!0:pix>=1&&0===src[pos+1]&&(hole=!0),(outer||hole)&&(++nbd,contours.push(CV.borderFollowing(src,pos,nbd,{x:j,y:i},hole,deltas))));return contours},CV.borderFollowing=function(src,pos,nbd,point,hole,deltas){var pos1,pos3,pos4,s,s_end,s_prev,contour=[];contour.hole=hole,s=s_end=hole?0:4;do if(s=s-1&7,pos1=pos+deltas[s],0!==src[pos1])break;while(s!==s_end);if(s===s_end)src[pos]=-nbd,contour.push({x:point.x,y:point.y});else for(pos3=pos,s_prev=4^s;;){s_end=s;do pos4=pos3+deltas[++s];while(0===src[pos4]);if(s&=7,s_end>>>0>s-1>>>0?src[pos3]=-nbd:1===src[pos3]&&(src[pos3]=nbd),contour.push({x:point.x,y:point.y}),s_prev=s,point.x+=CV.neighborhood[s][0],point.y+=CV.neighborhood[s][1],pos4===pos&&pos3===pos1)break;pos3=pos4,s=s+4&7}return contour},CV.neighborhood=[[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1]],CV.neighborhoodDeltas=function(width){for(var deltas=[],len=CV.neighborhood.length,i=0;len>i;++i)deltas[i]=CV.neighborhood[i][0]+CV.neighborhood[i][1]*width;return deltas.concat(deltas)},CV.approxPolyDP=function(contour,epsilon){var pt,start_pt,end_pt,dist,max_dist,le_eps,dx,dy,i,j,k,slice={start_index:0,end_index:0},right_slice={start_index:0,end_index:0},poly=[],stack=[],len=contour.length;for(epsilon*=epsilon,k=0,i=0;3>i;++i)for(max_dist=0,k=(k+right_slice.start_index)%len,start_pt=contour[k],++k===len&&(k=0),j=1;len>j;++j)pt=contour[k],++k===len&&(k=0),dx=pt.x-start_pt.x,dy=pt.y-start_pt.y,dist=dx*dx+dy*dy,dist>max_dist&&(max_dist=dist,right_slice.start_index=j);for(epsilon>=max_dist?poly.push({x:start_pt.x,y:start_pt.y}):(slice.start_index=k,slice.end_index=right_slice.start_index+=slice.start_index,right_slice.start_index-=right_slice.start_index>=len?len:0,right_slice.end_index=slice.start_index,right_slice.end_index<right_slice.start_index&&(right_slice.end_index+=len),stack.push({start_index:right_slice.start_index,end_index:right_slice.end_index}),stack.push({start_index:slice.start_index,end_index:slice.end_index}));0!==stack.length;){if(slice=stack.pop(),end_pt=contour[slice.end_index%len],start_pt=contour[k=slice.start_index%len],++k===len&&(k=0),slice.end_index<=slice.start_index+1)le_eps=!0;else{for(max_dist=0,dx=end_pt.x-start_pt.x,dy=end_pt.y-start_pt.y,i=slice.start_index+1;i<slice.end_index;++i)pt=contour[k],++k===len&&(k=0),dist=Math.abs((pt.y-start_pt.y)*dx-(pt.x-start_pt.x)*dy),dist>max_dist&&(max_dist=dist,right_slice.start_index=i);le_eps=epsilon*(dx*dx+dy*dy)>=max_dist*max_dist}le_eps?poly.push({x:start_pt.x,y:start_pt.y}):(right_slice.end_index=slice.end_index,slice.end_index=right_slice.start_index,stack.push({start_index:right_slice.start_index,end_index:right_slice.end_index}),stack.push({start_index:slice.start_index,end_index:slice.end_index}))}return poly},CV.erode=function(imageSrc,imageDst){return CV.applyKernel(imageSrc,imageDst,Math.min)},CV.dilate=function(imageSrc,imageDst){return CV.applyKernel(imageSrc,imageDst,Math.max)},CV.applyKernel=function(imageSrc,imageDst,fn){var value,i,j,k,src=imageSrc.data,dst=imageDst.data,width=imageSrc.width,height=imageSrc.height,offsets=[-width-1,-width,-width+1,-1,1,width-1,width,width+1],klen=offsets.length,pos=0;for(i=0;width>i;++i)dst[pos++]=0;for(i=2;height>i;++i){for(dst[pos++]=0,j=2;width>j;++j){for(value=src[pos],k=0;klen>k;++k)value=fn(value,src[pos+offsets[k]]);dst[pos++]=value}dst[pos++]=0}for(i=0;width>i;++i)dst[pos++]=0;return imageDst.width=imageSrc.width,imageDst.height=imageSrc.height,imageDst},CV.convexHull=function(points){var point,deque=[],i=3;if(points.length>=3)for(CV.position(points[0],points[1],points[2])>0?(deque.push(points[0]),deque.push(points[1])):(deque.push(points[1]),deque.push(points[0])),deque.push(points[2]),deque.unshift(points[2]);i<points.length;++i)if(point=points[i],CV.position(point,deque[0],deque[1])<0||CV.position(deque[deque.length-2],deque[deque.length-1],point)<0){for(;CV.position(deque[deque.length-2],deque[deque.length-1],point)<=0;)deque.pop();for(deque.push(point);CV.position(point,deque[0],deque[1])<=0;)deque.shift();deque.unshift(point)}return deque},CV.position=function(p1,p2,p3){return(p2.x-p1.x)*(p3.y-p1.y)-(p3.x-p1.x)*(p2.y-p1.y)},CV.convexityDefects=function(points,hull){var curr,next,point,dx0,dy0,scale,defect,isDefect,idx1,idx2,idx3,sign,inc,depth,dx,dy,dist,i,j,defects=[],len=hull.length;if(len>=3)for(idx1=CV.indexPoint(points,hull[0]),idx2=CV.indexPoint(points,hull[1]),idx3=CV.indexPoint(points,hull[2]),sign=0,sign+=idx2>idx1?1:0,sign+=idx3>idx2?1:0,sign+=idx1>idx3?1:0,inc=2===sign?1:-1,j=idx1,curr=hull[0],i=1;i!==len;++i){for(next=hull[i],isDefect=!1,depth=0,dx0=next.x-curr.x,dy0=next.y-curr.y,scale=1/Math.sqrt(dx0*dx0+dy0*dy0),defect={start:curr,end:next};;){if(j+=inc,j=0>j?points.length-1:j%points.length,point=points[j],point.x===next.x&&point.y===next.y)break;dx=point.x-curr.x,dy=point.y-curr.y,dist=Math.abs(-dy0*dx+dx0*dy)*scale,dist>depth&&(isDefect=!0,defect.depth=depth=dist,defect.depthPoint=point)}isDefect&&defects.push(defect),curr=next}return defects},CV.indexPoint=function(points,point){for(var len=points.length,i=0;len>i&&(points[i].x!==point.x||points[i].y!==point.y);++i);return i},CV.area=function(poly){var x,y,xmin,xmax,ymin,ymax,area=0,len=poly.length,i=1;if(len>0){for(xmin=xmax=poly[0].x,ymin=ymax=poly[0].y;len>i;++i)x=poly[i].x,xmin>x&&(xmin=x),x>xmax&&(xmax=x),y=poly[i].y,ymin>y&&(ymin=y),y>ymax&&(ymax=y);area=(xmax-xmin+1)*(ymax-ymin+1)}return area},"function"==typeof define&&define.amd?define("cv",CV):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=CV)},{}],2:[function(require,module,exports){if("function"==typeof require)var CV=require("./cv.js");var HT=HT||{};HT.Tracker=function(params){this.params=params||{},this.mask=new CV.Image,this.eroded=new CV.Image,this.contours=[],this.skinner=new HT.Skinner},HT.Tracker.prototype.detect=function(image){return this.skinner.mask(image,this.mask),this.params.fast?this.blackBorder(this.mask):(CV.erode(this.mask,this.eroded),CV.dilate(this.eroded,this.mask)),this.contours=CV.findContours(this.mask),this.findCandidate(this.contours,image.width*image.height*.05,.005)},HT.Tracker.prototype.findCandidate=function(contours,minSize,epsilon){var contour,candidate;return contour=this.findMaxArea(contours,minSize),contour&&(contour=CV.approxPolyDP(contour,contour.length*epsilon),candidate=new HT.Candidate(contour)),candidate},HT.Tracker.prototype.findMaxArea=function(contours,minSize){for(var area,contour,len=contours.length,i=0,maxArea=-(1/0);len>i;++i)area=CV.area(contours[i]),area>=minSize&&area>maxArea&&(maxArea=area,contour=contours[i]);return contour},HT.Tracker.prototype.blackBorder=function(image){var i,img=image.data,width=image.width,height=image.height,pos=0;for(i=0;width>i;++i)img[pos++]=0;for(i=2;height>i;++i)img[pos]=img[pos+width-1]=0,pos+=width;for(i=0;width>i;++i)img[pos++]=0;return image},HT.Candidate=function(contour){this.contour=contour,this.hull=CV.convexHull(contour),this.defects=CV.convexityDefects(contour,this.hull)},HT.Skinner=function(){},HT.Skinner.prototype.mask=function(imageSrc,imageDst){for(var r,g,b,h,s,v,value,src=imageSrc.data,dst=imageDst.data,len=src.length,i=0,j=0;len>i;i+=4)r=src[i],g=src[i+1],b=src[i+2],v=Math.max(r,g,b),s=0===v?0:255*(v-Math.min(r,g,b))/v,h=0,0!==s&&(h=v===r?30*(g-b)/s:v===g?60+(b-r)/s:120+(r-g)/s,0>h&&(h+=360)),value=0,v>=15&&250>=v&&h>=3&&33>=h&&(value=255),dst[j++]=value;return imageDst.width=imageSrc.width,imageDst.height=imageSrc.height,imageDst},"function"==typeof define&&define.amd?define("js-handtracking",HT):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=HT)},{"./cv.js":1}]},{},[2])(2)});
